<template>
    <svg @click="checkIn" width="66" height="66" viewBox="0 0 66 66" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M45.375 11H20.625V14.4375C20.625 14.8022 20.4801 15.1519 20.2223 15.4098C19.9644 15.6676 19.6147 15.8125 19.25 15.8125C18.8853 15.8125 18.5356 15.6676 18.2777 15.4098C18.0199 15.1519 17.875 14.8022 17.875 14.4375V11H15.125C13.3016 11 11.553 11.7243 10.2636 13.0136C8.97433 14.303 8.25 16.0516 8.25 17.875V23.375H57.75V17.875C57.75 16.0516 57.0257 14.303 55.7364 13.0136C54.447 11.7243 52.6984 11 50.875 11H48.125V14.4375C48.125 14.8022 47.9801 15.1519 47.7223 15.4098C47.4644 15.6676 47.1147 15.8125 46.75 15.8125C46.3853 15.8125 46.0356 15.6676 45.7777 15.4098C45.5199 15.1519 45.375 14.8022 45.375 14.4375V11ZM48.125 8.25H50.875C52.139 8.25 53.3906 8.49896 54.5583 8.98266C55.7261 9.46636 56.7871 10.1753 57.6809 11.0691C58.5747 11.9629 59.2836 13.0239 59.7673 14.1917C60.251 15.3594 60.5 16.611 60.5 17.875V50.875C60.5 52.139 60.251 53.3906 59.7673 54.5583C59.2836 55.7261 58.5747 56.7871 57.6809 57.6809C56.7871 58.5747 55.7261 59.2836 54.5583 59.7673C53.3906 60.251 52.139 60.5 50.875 60.5H15.125C13.861 60.5 12.6094 60.251 11.4417 59.7673C10.2739 59.2836 9.21286 58.5747 8.3191 57.6809C7.42533 56.7871 6.71636 55.7261 6.23266 54.5583C5.74896 53.3906 5.5 52.139 5.5 50.875V17.875C5.5 16.611 5.74896 15.3594 6.23266 14.1917C6.71636 13.0239 7.42533 11.9629 8.3191 11.0691C9.21286 10.1753 10.2739 9.46636 11.4417 8.98266C12.6094 8.49896 13.861 8.25 15.125 8.25H17.875V6.1875C17.875 5.82283 18.0199 5.47309 18.2777 5.21523C18.5356 4.95737 18.8853 4.8125 19.25 4.8125C19.6147 4.8125 19.9644 4.95737 20.2223 5.21523C20.4801 5.47309 20.625 5.82283 20.625 6.1875V8.25H45.375V6.1875C45.375 5.82283 45.5199 5.47309 45.7777 5.21523C46.0356 4.95737 46.3853 4.8125 46.75 4.8125C47.1147 4.8125 47.4644 4.95737 47.7223 5.21523C47.9801 5.47309 48.125 5.82283 48.125 6.1875V8.25ZM57.75 26.125H8.25V50.875C8.25 52.6984 8.97433 54.447 10.2636 55.7364C11.553 57.0257 13.3016 57.75 15.125 57.75H50.875C52.6984 57.75 54.447 57.0257 55.7364 55.7364C57.0257 54.447 57.75 52.6984 57.75 50.875V26.125ZM21.0897 41.3985C20.8162 41.1571 20.6498 40.8169 20.6272 40.4528C20.6045 40.0887 20.7273 39.7305 20.9688 39.457C21.2102 39.1835 21.5503 39.0171 21.9144 38.9944C22.2785 38.9717 22.6367 39.0946 22.9102 39.336L29.2297 44.9144C29.5004 45.1527 29.8538 45.2751 30.2139 45.2553C30.574 45.2355 30.9119 45.0751 31.1547 44.8085L42.7488 32.0746C42.9957 31.811 43.3365 31.6552 43.6974 31.6409C44.0584 31.6265 44.4105 31.7547 44.6776 31.9978C44.9447 32.241 45.1055 32.5794 45.1251 32.9401C45.1447 33.3008 45.0216 33.6547 44.7824 33.9254L33.1897 46.6592C32.4608 47.4599 31.4462 47.9419 30.365 48.001C29.2837 48.0602 28.2226 47.6919 27.4106 46.9755L21.0897 41.3985Z" 
        :style="{'fill':checkInColor}"/>
    </svg>
    
</template>

<script>
import { computed, onMounted, ref } from 'vue';
import { useStore } from 'vuex'
import { ElNotification, ElMessage } from 'element-plus'
import {getDateDiff} from "@/assets/utils/util-method.js"

export default {
    name : "CheckIn",
    setup(){
        //userInfo
        let userInfo = JSON.parse(window.localStorage.getItem("userInfo"));
        const store = useStore();
        let checkInColor = ref("black")

        onMounted(()=>{        
            const lastLoginTime = window.localStorage.getItem("lastLoginTime");
            if(lastLoginTime != null && getDateDiff(new Date(), new Date(lastLoginTime)) == 0) {
                store.commit("headerButton/UPDATE_IS_CHECKED", true);
                checkInColor.value = "#FF9393"
            }
        })
        function checkIn(){
            store.dispatch("headerButton/getUserLastLoginTime", userInfo.id);
            if(checkInColor.value ==  "#FF9393"){
                ElMessage({
                    type: 'warning',
                    message: 'Already checked in!',
                    grouping:true,
                })
            }else{
                ElMessage({
                    type :'success',
                    message: 'Successfully check in!',
                    grouping:true,
                })
            }
            checkInColor.value = "#FF9393"
        }

        return {
            checkIn, 
            checkInColor
        }
    }
}
</script>

<style scoped>
    @import "@/assets/css/svg.css";

    .checked{
        fill: '#FF9393'
    }
    .unchekced{
        fill: black
    }
</style>